name: Deploy Website

on:
  push:
    branches:
      - main  # mainにPushされたらスタート

jobs:
  # 1. テスト環境（gh-pagesブランチの /test フォルダ）にデプロイ
  deploy-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy to Test
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages      # デプロイ先ブランチ
          folder: .             # リポジトリの全ファイルを送る
          target-folder: test   # 公開URL/test/ の中に配置される

  # 2. 本番環境（gh-pagesブランチのルート）にデプロイ
  deploy-production:
    needs: deploy-test         # テストデプロイが終わるまで待つ
    environment: production     # ★ここでGitHub上の「承認」が必要になる
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy to Production
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: .
          # target-folderを指定しないので、ルート直下に配置（本番反映）
