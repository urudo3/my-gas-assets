name: Deploy Website

on:
  push:
    branches: ["main"]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  # --------------------------------------------------
  # 1. テスト環境デプロイ (URL: .../test/index.html)
  # --------------------------------------------------
  deploy-test:
    runs-on: ubuntu-latest
    environment:
      name: github-pages # 承認なしで即反映される環境
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Prepare Test Directory
        run: |
          mkdir out
          cp index.html out/
          # 他にファイルがあればここで out/ にコピー

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'out' # outフォルダの中身をアップロード

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4

  # --------------------------------------------------
  # 2. 本番環境デプロイ (URL: .../index.html)
  # --------------------------------------------------
  deploy-production:
    needs: deploy-test
    runs-on: ubuntu-latest
    environment:
      name: production # ★Settingsで「承認」をつけた環境名
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.' # ルート直下（outを通さない）をアップロード

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
